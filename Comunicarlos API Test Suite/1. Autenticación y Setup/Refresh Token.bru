meta {
  name: Refresh Token
  type: http
  seq: 10
}

post {
  url: {{base_url}}/api/v1/auth/refresh
  body: none
  auth: bearer
}

auth:bearer {
  token: {{token_solicitante}}
}

assert {
  res.status: eq 200
  res.body.expires_in: isNumber
}

script:post-response {
  var jsonData = res.getBody();
    if(jsonData.token) {
        bru.setEnvVar("token_solicitante", jsonData.token);
    }
}

tests {
  
  test("Debe retornar un nuevo token v√°lido", function() {
    const body = res.getBody();
    
    expect(body.token).to.be.a('string');
    expect(body.token.length).to.be.greaterThan(20);
    expect(body.tipo).to.equal("Bearer");
    
  
    bru.setEnvVar("token_solicitante", body.token);
    console.log("Token de solicitante actualizado en el entorno.");
  });
}

settings {
  encodeUrl: true
}
