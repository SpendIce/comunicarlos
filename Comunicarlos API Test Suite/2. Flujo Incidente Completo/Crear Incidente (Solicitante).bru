meta {
  name: Crear Incidente (Solicitante)
  type: http
  seq: 1
}

post {
  url: {{base_url}}/api/v1/requerimientos
  body: json
  auth: inherit
}

headers {
  Authorization: Bearer {{token_solicitante}}
  Content-Type: application/json
}

body:json {
  {
    "tipo": "INCIDENTE",
    "titulo": "Internet muy lento",
    "descripcion": "La velocidad de descarga es menor a 1MB desde esta mañana.",
    "categoria": "SERVICIO_INACCESIBLE",
    "nivel_urgencia": "IMPORTANTE"
  }
}

assert {
  res.status: eq 201
  res.body.estado: eq NUEVO
  res.body.id: isNumber
}

tests {
  test("El incidente debe tener un ID válido", function() {
    const body = res.getBody();
    expect(body.id).to.be.a('number');
    expect(body.id).to. be.above(0);
  
    bru.setEnvVar("id_incidente", body.id);
  });
  
  test("La urgencia debe coincidir con el request", function() {
    const body = res.getBody();
    // Validamos que respete el snake_case
    expect(body.nivel_urgencia).to.equal("IMPORTANTE"); 
  });
}
